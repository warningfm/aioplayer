!function(t,e){"use strict";"function"==typeof define&&define.amd?define("RowSorter",e):"object"==typeof exports?module.exports=e():t.RowSorter=e()}(this,function(){"use strict";function t(r,u){if(!(this instanceof t))return new t(r,u);if("string"==typeof r&&(r=l(r)),h(r,"table")===!1)throw new Error("Table not found.");return r[S]instanceof t?r[S]:(this._options=_(C,u),this._table=r,this._tbody=r,this._rows=[],this._lastY=!1,this._draggingRow=null,this._firstTouch=!0,this._lastSort=null,this._ended=!0,this._mousedown=g(e,this),this._mousemove=g(i,this),this._mouseup=g(n,this),this._touchstart=g(s,this),this._touchmove=g(a,this),this._touchend=g(o,this),this._touchId=null,this._table[S]=this,void this.init())}function e(t){return t=t||window.event,!this._start(t.target||t.srcElement,t.clientY)||(t.preventDefault?t.preventDefault():t.returnValue=!1,!1)}function s(t){if(1===t.touches.length){var e=t.touches[0],s=document.elementFromPoint(e.clientX,e.clientY);if(this._touchId=e.identifier,this._start(s,e.clientY))return t.preventDefault?t.preventDefault():t.returnValue=!1,!1}return!0}function i(t){return t=t||window.event,this._move(t.target||t.srcElement,t.clientY),!0}function a(t){if(1===t.touches.length){var e=t.touches[0],s=document.elementFromPoint(e.clientX,e.clientY);this._touchId===e.identifier&&this._move(s,e.clientY)}return!0}function n(){this._end()}function o(t){t.changedTouches.length>0&&this._touchId===t.changedTouches[0].identifier&&this._end()}function r(e){return e instanceof t?e:("string"==typeof e&&(e=l(e)),h(e,"table")&&S in e&&e[S]instanceof t?e[S]:null)}function l(t){var e=j(document,t);return e.length>0&&h(e[0],"table")?e[0]:null}function h(t,e){return t&&"object"==typeof t&&"nodeName"in t&&t.nodeName===e.toUpperCase()}function u(t,e,s){var i=t.parentNode;1===s?e.nextSibling?i.insertBefore(t,e.nextSibling):i.appendChild(t):s===-1&&i.insertBefore(t,e)}function c(t,e){for(var s=t.rows,i=s.length,a=0;a<i;a++)if(e===s[a])return a;return-1}function d(t,e,s){t.attachEvent?t.attachEvent("on"+e,s):t.addEventListener(e,s,!1)}function m(t,e,s){t.detachEvent?t.detachEvent("on"+e,s):t.removeEventListener(e,s,!1)}function p(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function f(t,e){if(e=p(e),""===e)return!1;if(e.indexOf(" ")!==-1){for(var s=e.replace(/\s+/g," ").split(" "),i=0,a=s.length;i<a;i++)if(f(t,s[i])===!1)return!1;return!0}return t.classList?!!t.classList.contains(e):!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function y(t,e){if(e=p(e),""!==e)if(e.indexOf(" ")===-1)f(t,e)===!1&&(t.classList?t.classList.add(e):t.className+=" "+e);else for(var s=e.replace(/\s+/g," ").split(" "),i=0,a=s.length;i<a;i++)y(t,s[i])}function v(t,e){if(e=p(e),""!==e)if(e.indexOf(" ")===-1)f(t,e)&&(t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," "));else for(var s=e.replace(/\s+/g," ").split(" "),i=0,a=s.length;i<a;i++)v(t,s[i])}function g(t,e){return Function.prototype.bind?t.bind(e):function(){t.apply(e,k.slice.call(arguments))}}function _(t,e){if(P)return P.extend({},t,e);var s,i={};for(s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&"[object Object]"===Object.prototype.toString.call(e))for(s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);return i}function j(t,e){return P?P.makeArray(P(t).find(e)):t.querySelectorAll(e)}function b(t,e){var s=1,i=20,a=t;for(e=e.toLowerCase();a.tagName&&a.tagName.toLowerCase()!==e;){if(s>i||!a.parentNode)return null;a=a.parentNode,s++}return a}function w(t,e){if(k.indexOf)return k.indexOf.call(t,e);for(var s=0,i=t.length;s<i;s++)if(e===t[s])return s;return-1}var P=window.jQuery||!1,k=Array.prototype,$=!!("ontouchstart"in document),S="data-rowsorter",C={handler:null,tbody:!0,tableClass:"sorting-table",dragClass:"sorting-row",stickTopRows:0,stickBottomRows:0,onDragStart:null,onDragEnd:null,onDrop:null};return t.prototype.init=function(){if(this._options.tbody){var t=this._table.getElementsByTagName("tbody");t.length>0&&(this._tbody=t[0])}if("function"!=typeof this._options.onDragStart&&(this._options.onDragStart=null),"function"!=typeof this._options.onDrop&&(this._options.onDrop=null),"function"!=typeof this._options.onDragEnd&&(this._options.onDragEnd=null),("number"!=typeof this._options.stickTopRows||this._options.stickTopRows<0)&&(this._options.stickTopRows=0),("number"!=typeof this._options.stickBottomRows||this._options.stickBottomRows<0)&&(this._options.stickBottomRows=0),d(this._table,"mousedown",this._mousedown),d(document,"mouseup",this._mouseup),$&&(d(this._table,"touchstart",this._touchstart),d(this._table,"touchend",this._touchend)),"onselectstart"in document){var e=this;d(document,"selectstart",function(t){var s=t||window.event;if(null!==e._draggingRow)return s.preventDefault?s.preventDefault():s.returnValue=!1,!1})}},t.prototype._start=function(t,e){if(this._draggingRow&&this._end(),this._rows=this._tbody.rows,this._rows.length<2)return!1;if(this._options.handler){var s=j(this._table,this._options.handler);if(!s||w(s,t)===-1)return!1}var i=b(t,"tr"),a=c(this._tbody,i);return!(a===-1||this._options.stickTopRows>0&&a<this._options.stickTopRows||this._options.stickBottomRows>0&&a>=this._rows.length-this._options.stickBottomRows)&&(this._draggingRow=i,this._options.tableClass&&y(this._table,this._options.tableClass),this._options.dragClass&&y(this._draggingRow,this._options.dragClass),this._oldIndex=a,this._options.onDragStart&&this._options.onDragStart(this._tbody,this._draggingRow,this._oldIndex),this._lastY=e,this._ended=!1,d(this._table,"mousemove",this._mousemove),$&&d(this._table,"touchmove",this._touchmove),!0)},t.prototype._move=function(t,e){if(this._draggingRow){var s=e>this._lastY?1:e<this._lastY?-1:0;if(0!==s){var i=b(t,"tr");if(i&&i!==this._draggingRow&&w(this._rows,i)!==-1){var a=!0;if(this._options.stickTopRows>0||this._options.stickBottomRows>0){var n=c(this._tbody,i);(this._options.stickTopRows>0&&n<this._options.stickTopRows||this._options.stickBottomRows>0&&n>=this._rows.length-this._options.stickBottomRows)&&(a=!1)}a&&u(this._draggingRow,i,s),this._lastY=e}}}},t.prototype._end=function(){if(!this._draggingRow)return!0;this._options.tableClass&&v(this._table,this._options.tableClass),this._options.dragClass&&v(this._draggingRow,this._options.dragClass);var t=c(this._tbody,this._draggingRow);if(t!==this._oldIndex){var e=this._lastSort;this._lastSort={previous:e,newIndex:t,oldIndex:this._oldIndex},this._options.onDrop&&this._options.onDrop(this._tbody,this._draggingRow,t,this._oldIndex)}else this._options.onDragEnd&&this._options.onDragEnd(this._tbody,this._draggingRow,this._oldIndex);this._draggingRow=null,this._lastY=!1,this._touchId=null,this._ended=!0,m(this._table,"mousemove",this._mousemove),$&&m(this._table,"touchmove",this._touchmove)},t.prototype.revert=function(){if(null!==this._lastSort){var t=this._lastSort,e=t.oldIndex,s=t.newIndex,i=this._tbody.rows,a=i.length-1;i.length>1&&(e<a?this._tbody.insertBefore(i[s],i[e+(s>e?0:1)]):this._tbody.appendChild(i[s])),this._lastSort=t.previous}},t.prototype.undo=t.prototype.revert,t.prototype.destroy=function(){this._table[S]=null,this._ended===!1&&this._end(),m(this._table,"mousedown",this._mousedown),m(document,"mouseup",this._mouseup),$&&(m(this._table,"touchstart",this._touchstart),m(this._table,"touchend",this._touchend))},t.revert=function(t,e){var s=r(t);if(null===s&&e===!1)throw new Error("Table not found.");s&&s.revert()},t.undo=t.revert,t.destroy=function(t,e){var s=r(t);if(null===s&&e===!1)throw new Error("Table not found.");s&&s.destroy()},P&&(P.fn.extend({rowSorter:function(e){var s=[];return this.each(function(i,a){s.push(new t(a,e))}),1===s.length?s[0]:s}}),P.rowSorter={undo:t.undo,revert:t.revert,destroy:t.destroy}),t});