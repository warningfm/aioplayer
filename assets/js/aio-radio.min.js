var aio={},c=[];function loadSettings(data){if($.each(data,function(key,val){c.push(val)}),c.length<=0)return aioFatalError("NO CHANNELS DEFINED","Unable to find channels, please create one!"),!1;1<c.length&&($("li.channels").show(),$.each(c,function(key,val){aio.html=$('<li><a tabindex="1" href="#'+val.name+'">'+val.name+"</a></li>"),$("ul.channel-list").append(aio.html),aio.html.on("click",function(){if("onhashchange"in window)return!0;loadChannel($(this).text())})}));var win_hash=decodeURIComponent(window.location.href.split("#")[1]||"");if(""!=win_hash&&loadChannel(win_hash),""==win_hash&&"true"==s.usecookies){var cok=getCookie("last_channel");null!=cok&&loadChannel(cok,!0)}""==win_hash&&null==cok&&null!=s.default_channel&&loadChannel(s.default_channel,!0),null==s.channel.name&&loadChannel(c[0].name),"true"==s.history&&($(".history-toggle").show(),$(".history-toggle a").on("click",showHistory)),$(document).trigger("aio.loaded",data),pagination("main",!1),$(".preloader").addClass("loadComplete")}function loadChannel(name,grace){if(s.channel.name==name)return!1;for(var i=0;i<c.length;i++)if(c[i].name==name)var key_ok=i;if("number"!=typeof key_ok)return!0!==grace&&alert("Invalid Channel!"),console.log("Invalid channel: "+name),!1;if($(".channel-list li > a").removeClass("active"),$(".channel-list li").find('a[href="#'+name+'"]').addClass("active"),s.channel=c[key_ok],setCookie("last_channel",name,365),void 0!==s.channel.skin&&$("#main_theme").attr("href","templates/"+s.template+"/"+s.channel.skin),null!=s.channel.logo&&""!=s.channel.logo){var logoImg=new Image;logoImg.src=s.channel.logo,logoImg.onload=function(){$(".header .logo a img").attr("src",s.channel.logo)}}else $(".header .logo a img").attr("src",aio.defaultLogo);if($(".playlists a").each(function(){$(this).attr("href",$(this).attr("href").replace(/c=(.*)/,"c="+name))}),aio.onair=null,aio.history=[],$(".artist-preload").show(),$(".onair .time").html("00:00"),"true"==s.usecookies){var qualityCookie=getCookie("quality");null!=qualityCookie&&(aio.quality=qualityCookie)}else aio.quality=null;if(null==aio.quality||""==aio.quality||null==s.channel.streams[aio.quality])for(aio.quality in s.channel.streams)break;1<$.map(s.channel.streams,function(n,i){return i}).length?($("li.settings").show(),$("ul.streams-list").empty(),$.each(s.channel.streams,function(key,val){aio.html=$('<li><a tabindex="1" href="#">'+key+"</a></li>"),$("ul.streams-list").append(aio.html),aio.quality==key&&aio.html.find("a").addClass("active"),aio.html.on("click",function(){return $("ul.streams-list li > a").removeClass("active"),$(this).find("a").addClass("active"),aio.quality=$(this).text(),setCookie("quality",aio.quality,365),HTML5Player(),!1})})):$("li.settings").hide(),showHistory(!0),HTML5Player(),txt(s.lang["status-stopped"],!0),$(document).trigger("aio.quality.change",aio.quality),$(document).trigger("aio.channel.change",s.channel.name),clearInterval(aio.radioinfo),aio.radioinfo=setInterval(radioInfo,1e3*parseInt(s.stats_refresh)),radioInfo()}function HTML5Player(){var supplied=[],autoPlay="true"==s.autoplay?"play":"",volume_cookie=getCookie("volume"),obj=$("#jplayer-object"),ready=!1;if(obj.jPlayer("destroy"),$.each(s.channel.streams[aio.quality],function(key,value){s.channel.streams[aio.quality].title=s.title+" - "+s.channel.name,supplied.push(key)}),null==s.channel.streams[aio.quality])return alert("ERROR: The specified or selected stream quality does not exist!"),!1;obj.jPlayer({swfPath:"assets/flash/jquery.jplayer.swf",solution:"html, flash",supplied:supplied.join(", "),smoothPlayBar:!1,errorAlerts:!0,cssSelectorAncestor:".player",volume:null==volume_cookie?s.default_volume/100:volume_cookie,preload:"none",cssSelector:{play:".play",pause:".stop",mute:".volume-icon #volume",unmute:".volume-icon #muted",volumeBar:".volume-slider .vol-progress",volumeBarValue:".volume-slider .vol-progress .vol-bar"},ready:function(event){event.jPlayer.status.noVolume&&($(".volume-control").addClass("no-volume"),$(".volume-slider .player-status").css({"margin-top":"0"})),ready=!0,$(this).jPlayer("setMedia",s.channel.streams[aio.quality]),1!=$.jPlayer.platform.mobile&&$(this).jPlayer(autoPlay),$(document).trigger("aio.ready",event)},pause:function(){$(this).jPlayer("clearMedia"),$(this).jPlayer("setMedia",s.channel.streams[aio.quality]),"ERROR: Network error occurred!"!==txt()&&txt(s.lang["status-stopped"],!0)},error:function(event){if(1!==event.jPlayer.status.networkState)return obj.jPlayer("stop"),obj.jPlayer("setMedia",s.channel.streams[aio.quality]),txt("ERROR: Network error occurred!",!0),setTimeout(function(){console.log("Re-trying stream playback..."),obj.jPlayer("play")},2e3),!1;if(ready&&event.jPlayer.error.type===$.jPlayer.error.URL_NOT_SET)$(this).jPlayer("setMedia",s.channel.streams[aio.quality]),1!=$.jPlayer.platform.mobile&&$(this).jPlayer("play");else{if(!ready||event.jPlayer.error.type!==$.jPlayer.error.URL)return aioFatalError("PLAYBACK ERROR",event.jPlayer.error.message),!1;txt("ERROR: Playback failed, loading stream failed!",!0)}},volumechange:function(event){event.jPlayer.options.muted?(txt(s.lang["status-muted"]),$(".volume-icon #volume").hide(),$(".volume-icon #muted").show()):(txt(s.lang["status-volume"].replace("{LEVEL}",Math.floor(100*event.jPlayer.options.volume)+"%")),$(".volume-icon #muted").hide(),$(".volume-icon #volume").show()),setCookie("volume",event.jPlayer.options.volume,365)}}),$(".volume-control").on("mousedown",function(){var parent=$(".volume-slider .vol-progress");$("body").css({"-ms-user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}),$(document).on("mousemove",function(e){if(e.pageX-$(parent).offset().left<1)return!1;var total=$(".volume-slider .vol-progress").width();obj.jPlayer("option","muted",!1),obj.jPlayer("option","volume",(e.pageX-$(parent).offset().left+1)/total),aio.moving=!0}),$(document).on("mouseup",function(){$("body").removeAttr("style"),$(document).unbind("mousemove")})}),$(".playlists > a").unbind("click").on("click",function(){1==ready&&(obj.jPlayer("clearMedia"),txt(s.lang["status-stopped"],!0))}),obj.unbind($.jPlayer.event.play),obj.unbind($.jPlayer.event.playing),obj.bind($.jPlayer.event.play,function(event){txt(s.lang["status-init"].replace("{STREAM}",s.channel.name),!0)}),obj.bind($.jPlayer.event.playing,function(event){txt(s.lang["status-playing"].replace("{STREAM}",s.channel.name),!0)})}function radioInfo(){if(null==s.channel.name)return!1;var request={url:"index.php?c="+s.channel.name,async:!0,cache:!1,dataType:"json",timeout:1e3*parseInt(s.stats_refresh)-1e3};$.ajax(request).done(function(data){if(null==aio.onair&&(aio.onair={}),null==data.artist||null==data.title)return!1;if(data.artist==aio.onair.artist&&data.title==aio.onair.title&&data.image==aio.onair.image)return!1;if($(".view.main .artist").html('<a class="css-hint" data-title="'+data.artist+'" onclick="return false;" href="#">'+shorten(data.artist,s.artist_length)+"</a>"),$(".view.main .title").html('<a class="css-hint" data-title="'+data.title+'" onclick="return false;" href="#">'+shorten(data.title,s.title_length)+"</a>"),$(".artist-preload").show(),$(".artist-img img").attr("src",data.image).one("load",function(){$(".artist-preload").hide()}),"true"==s.dynamic_title&&(null==aio.ptitle&&(aio.ptitle=document.title),document.title=data.artist+" - "+data.title+" | "+aio.ptitle),data.artist==s.default_artist&&data.title==s.default_title)var twitter_title=s.title+" #"+s.channel.name;else twitter_title='"'+data.artist+" - "+data.title+'"';var currentURL=window.location.href.split("#")[0];aio["facebook-url"]="https://www.facebook.com/sharer/sharer.php?u="+currentURL,aio["twitter-url"]="https://twitter.com/share?url="+currentURL+"&text="+encodeURIComponent(s.lang["twitter-share"].replace("{TRACK}",twitter_title)),aio.onair={artist:data.artist,title:data.title,image:data.image,time:(new Date).getTime()},void 0===data.history||data.history.length<1?addHistory(aio.onair):(aio.history=data.history,updateHistory()),onAirTimer(),$(document).trigger("aio.track.change",aio.onair),null!=data.status&&"disabled"==data.status&&clearInterval(aio.radioinfo)}).fail(function(jqxhr){$(".artist-preload").hide(),console.log("Loading artwork failed! Possible network error occurred!")})}function onAirTimer(){if(clearInterval(aio.timer),1!=s.channel["show-time"])return $(".onair .time").html("00:00").hide(),!1;aio.timer=setInterval(function(){if(1!=s.channel["show-time"])return clearInterval(aio.timer),$(".onair .time").hide(),!1;if(null==aio.onair||"number"!=typeof aio.onair.time)return!1;var timer,ctime=((new Date).getTime()-aio.onair.time)/1e3,hour=Math.floor(ctime/3600%60),min=Math.floor(ctime/60%60),sec=Math.floor(ctime%60);timer=1<=hour?(hour<10?"0":"")+hour+":"+(min<10?"0":"")+min+":"+(sec<10?"0":"")+sec:(min<10?"0":"")+min+":"+(sec<10?"0":"")+sec,$(".onair .time").show().html(timer)},1e3)}function aioFatalError(title,message){return $(".preloader").removeClass("loadComplete").css({visibility:"visible",opacity:1}),$(".preloader .text_area").html('<span style="color: red;"><div style="font-weight: 500;">'+title+"</div> "+message+"</span>"),!1}function addHistory(data){"object"!=typeof aio.history&&(aio.history=[]),"object"==typeof aio.history&&19<aio.history.length&&aio.history.pop(),aio.history.unshift(data),updateHistory()}function updateHistory(){var history_html=$('<div class="table-scroll"><table><thead><tr><th class="history-artwork"></th><th class="artist-title">'+s.lang["history-artist-title"]+'</th>\t\t<th class="timeago">'+s.lang["history-added"]+"</th></tr></thead><tbody></tbody></table></div>");void 0!==aio.history?($.each(aio.history,function(key,val){var $now=new Date(val.time);$(history_html).find("tbody").append('<tr title="'+$now.getHours()+":"+($now.getMinutes()<9?"0"+$now.getMinutes():$now.getMinutes())+'">\t\t\t<td class="history-artwork"><img src="'+val.image+'" alt="image" width="30" height="30"></td>\t\t\t<td>'+val.artist+" - "+val.title+'</td>\t\t\t<td class="timeago">'+timeAgo(val.time)+"</td></tr>")}),$(".history-content").html(history_html)):$(".history-content").html('<div class="text-center"><br><br><br><br><b>No history available at this time.</b></div>'),$(document).trigger("aio.history.change",aio.history)}function showHistory(force_disable){var elm=$(".history-toggle");return null!=$(elm).attr("data-open")?($(elm).removeAttr("data-open").find("a").removeClass("active"),pagination("main")):!0!==force_disable&&(updateHistory(),$(elm).attr("data-open","true").find("a").addClass("active"),pagination("history")),!1}function pagination(page_class,animation,resize_event){!0!==resize_event&&$(window).unbind("resize");for(var pages=$(".main-container .view"),page_width=$(pages).first().width(),total_pages=pages.length,page_number=0,$i=0;$i<total_pages;$i++)if($(pages[$i]).hasClass(page_class)){page_number=$i;break}null!=animation&&!1===animation&&($(pages[0]).css("transition","none"),setTimeout(function(){$(pages[0]).css("transition","")},300)),$(pages[0]).css("margin-left","-"+(0!=page_number?page_width*page_number:0)+"px"),!0!==resize_event&&$(window).bind("resize",function(){pagination(page_class,!1,!0)})}function txt(text,perment){var status=$(".player-status");if(void 0===text)return status.text();1!=perment&&void 0!==aio["txt-status"]||(aio["txt-status"]=text),null!=aio.txtobj&&clearTimeout(aio.txtobj),status.html(text),console.log(text),$(document).trigger("aio.status.change",text),null==perment&&(aio.txtobj=setTimeout(function(){status.hide().html(aio["txt-status"]).fadeIn("slow")},2e3))}function shorten($text,$length){if("0"==$length)return $text;var length=$length||10;return $text.length>length&&($text=$text.substring(0,length)+"&hellip;"),$text}function timeAgo(timestamp){var seconds=Math.floor(((new Date).getTime()-timestamp)/1e3);return 1<=Math.floor(seconds/3600)?Math.floor(seconds/3600)+" "+s.lang["history-hour-ago"]:1<=Math.floor(seconds/60)?Math.floor(seconds/60)+" "+s.lang["history-min-ago"]:"0"==seconds?s.lang["history-just-now"]:Math.floor(seconds)+" "+s.lang["history-sec-ago"]}function setCookie(name,value,expires,path,domain,secure){if("true"!=s.usecookies)return null;var today=new Date;today.setTime(today.getTime()),expires&&(expires=1e3*expires*60*60*24);var expires_date=new Date(today.getTime()+expires);document.cookie=name+"="+encodeURI(value)+(expires?";expires="+expires_date.toGMTString():"")+(path?";path="+path:"")+(domain?";domain="+domain:"")+(secure?";secure":"")}function getCookie(name){if("true"!=s.usecookies)return null;var start=document.cookie.indexOf(name+"="),len=start+name.length+1;if(!start&&name!=document.cookie.substring(0,name.length))return null;if(-1==start)return null;var end=document.cookie.indexOf(";",len);return-1==end&&(end=document.cookie.length),decodeURI(document.cookie.substring(len,end))}function deleteCookie(name,path,domain){if("true"!=s.usecookies)return null;getCookie(name)&&(document.cookie=name+"="+(path?";path="+path:"")+(domain?";domain="+domain:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")}function isTouchDevice(){return void 0!==window.ontouchstart}!function($){if("undefined"==typeof s)return aioFatalError("ERROR","Unable to read player configuration!");aio.defaultLogo=$(".header .logo a img").attr("src"),$.getJSON("?c=all&t="+s.template,loadSettings).fail(function(jqxhr,textStatus,error){return console.log("Unable to load list of channels because "+textStatus+" "+error),aioFatalError("ERROR","Unable to load list of available channels!"),!1}),$("li.settings a, li.channels a").on("click",function(){var elm=$(this);return $(elm).hasClass("active")?$(elm).removeClass("active").next("ul").removeClass("active"):($("ul > li.settings > a, ul > li.channels > a").removeClass("active"),$("ul > li.settings > ul, ul > li.channels > ul").removeClass("active"),$(elm).addClass("active").next("ul").addClass("active"),$(document).on("click",function(){$(elm).removeClass("active").next("ul").removeClass("active")})),!1}),$(".facebook-share, .twitter-share").on("click",function(){return null==aio["facebook-url"]||null==aio["twitter-url"]||window.open($(this).hasClass("facebook-share")?aio["facebook-url"]:aio["twitter-url"],"share","width=800, height=400"),!1}),$(window).on("hashchange",function(){var channel_name=decodeURIComponent(window.location.href.split("#")[1]||"");null!=s.channel.name&&""!=channel_name&&loadChannel(channel_name)}),"function"==typeof aio_init&&aio_init(),$(document).trigger("aio.init",s)}(jQuery);